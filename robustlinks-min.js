var RLuriPatternsToExclude=["https?://dx.doi.org*","https?://doi.org*"],RLhasHTTPRegexp=/^https?:/,RLhasColonRegexp=/:/;function RLIsURL(e){return Boolean(e)&&(RLhasHTTPRegexp.test(e)||!RLhasColonRegexp.test(e))}var RLWebArchiveBaseUriToExclude=["https?://webarchive.nationalarchives.gov.uk/*","https?://web.archive.org/*"],RLSchemaOrgAttributes={datePublished:"Archived version near page creation date ",dateModified:"Archived version near page modified date "};Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=this.length;t--;)if(this[t]===e)return t;return-1});var RL_ID=function(){return"RL_"+Math.random().toString(36).substr(2,9)};function RL_appendHiddenLink(e,t,r){var n=document.createElement("li"),a=document.createElement("div"),i=document.createElement("a");i.setAttribute("class","robustLinks RLItem"),i.href=r,i.innerHTML=t,a.appendChild(i),n.appendChild(a),e.appendChild(n)}function RLAddZero(e){return e<10&&(e="0"+e),e}function RLFormatDate(e){var t=new Date(e);if(isNaN(t)&&(t=new Date(e.replace(/ /g,"T")),isNaN(t)))return"Invalid date";var r="";return r+=t.getUTCFullYear(),r+=RLAddZero(t.getUTCMonth()+1),r+=RLAddZero(t.getUTCDate()),r+=RLAddZero(t.getUTCHours()),r+=RLAddZero(t.getUTCMinutes()),r+=RLAddZero(t.getUTCSeconds())}function RLPrintDate(e){var t=RLFormatDate(e),r=t.substr(0,4)+"-"+t.substr(4,2)+"-"+t.substr(6,2);return"000000"!=t.substr(8,6)&&(r+=" "+t.substr(8,2)+":"+t.substr(10,2)+":"+t.substr(12,2)),r}var RLLastOpen,RLDomainRegExp=new RegExp("(?:https?://)?(?:www\\.)?((?:[A-Za-z0-9_\\.])+)(?:/.*)?","i");function RLPrintDomainName(e){var t=e.match(RLDomainRegExp);if(t&&t.length>1){var r=t[1];return r.length>15?r.substr(0,15)+"...":r}return"unknown archive"}function RLCloseLastOpen(){RLLastOpen&&(RLLastOpen.setAttribute("aria-hidden","true"),RLLastOpen=null)}function RLGetAttribute(e,t){try{return e.getAttribute(t).trim()}catch(e){return""}}function robustify_links_on_page(){console.log("callable robust links started...");for(var e=document.getElementsByTagName("meta"),t={},r=0;r<e.length;r++){var n=RLGetAttribute(e[r],"itemprop");if(n in RLSchemaOrgAttributes){var a=RLGetAttribute(e[r],"content");t[n]={linkstr:"",printstr:""},t[n].linkstr=RLFormatDate(a),t[n].printstr=RLPrintDate(a)}}var i=document.getElementsByTagName("a");for(r=0;r<i.length;r++){var o=RLGetAttribute(i[r],"href");if(console.log("examining href value "+o),0==!o.search("http")){var s=window.location,u=s.protocol+"//"+s.host;0==!o.search("/|../|./")&&(u+="/"),o=u+o}var d=RLGetAttribute(i[r],"data-originalurl");console.log("got original value of "+d);var l=Boolean(d);l||(d=o);var L=RLGetAttribute(i[r],"data-versionurl");console.log("got memento value of "+L);var c=Boolean(L);!c&&l&&(L=o);var p=RLGetAttribute(i[r],"data-versiondate");console.log("got datetime of "+p);var R=Boolean(p),m=new RegExp("(?:"+RLuriPatternsToExclude.join(")|(?:")+")"),h=i[r].href.length>0&&(" "+i[r].className+" ").indexOf(" robustLinks ")<0&&(Object.keys(t).length>0||l||c||R)&&!m.test(o)&&RLIsURL(o);if(console.log("showLink is "),console.log(h),h){var g=RL_ID(),v=document.createElement("span");v.setAttribute("role","navigation"),v.setAttribute("aria-label","RLElement");var b=document.createElement("ul"),f=document.createElement("li");f.setAttribute("aria-label","RLOuter");var A=document.createElement("a");A.href="",A.setAttribute("aria-haspopup","true"),A.setAttribute("class","robustLinks dropDownButton RLArrow"),A.setAttribute("aria-controls",g);var k=document.createElement("div");k.setAttribute("class","robustLinks dropDownButton RLIcon");var E=document.createElement("ul");E.setAttribute("class","RLMenu"),E.id=g,E.setAttribute("aria-hidden","true");var C=document.createElement("li");for(n in C.setAttribute("class","RLTitle"),C.innerHTML="Robust Links",E.appendChild(C),t){var D="http://timetravel.mementoweb.org/memento/"+t[n].linkstr+"/"+d;RL_appendHiddenLink(E,RLSchemaOrgAttributes[n]+t[n].printstr,D)}if(R){D="http://timetravel.mementoweb.org/memento/"+RLFormatDate(p)+"/"+d;RL_appendHiddenLink(E,"Archived version near date<br>"+RLPrintDate(p),D)}c&&RL_appendHiddenLink(E,"Archived version at "+RLPrintDomainName(L),L),l&&RL_appendHiddenLink(E,"Live version",d),f.appendChild(A),f.appendChild(E),b.appendChild(f),v.appendChild(b),A.parentNode.insertBefore(k,A),A.onclick=function(e){var t=document.getElementById(this.getAttribute("aria-controls")),r="true"==t.getAttribute("aria-hidden");return RLCloseLastOpen(),r?(t.setAttribute("aria-hidden","false"),RLLastOpen=t):(t.setAttribute("aria-hidden","true"),RLLastOpen=null),e.stopPropagation(),!1},i[r].parentNode.insertBefore(v,i[r].nextSibling)}}document.onclick=RLCloseLastOpen}document.addEventListener("DOMContentLoaded",function(){robustify_links_on_page()},!1);