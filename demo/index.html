<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RobustLinksV2 Showcase</title>
    <link rel="stylesheet" href="robustlink.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            color: #333;
        }
        h1, h2, h3 {
            color: #0056b3;
        }
        .container {
            max-width: 900px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #eee;
        }
        .section:last-child {
            border-bottom: none;
        }
        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        code {
            font-family: "Courier New", Courier, monospace;
            color: #d14;
        }
        .robust-link-wrapper {
            display: inline-flex; /* Use flexbox to align anchor and arrow */
            align-items: center; /* Vertically align items */
            margin-right: 10px; /* Space between links */
            position: relative; /* For dropdown positioning */
        }
        .robust-dropdown-arrow {
            margin-left: 4px;
            cursor: pointer;
            user-select: none; /* Prevent text selection on arrow */
        }
        .robust-dropdown-menu {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1000;
            padding: 8px 0;
            border-radius: 4px;
            top: 100%; /* Position below the wrapper */
            left: 0;
        }
        .robust-dropdown-menu a {
            color: black;
            padding: 8px 16px;
            text-decoration: none;
            display: block;
        }
        .robust-dropdown-menu a:hover {
            background-color: #f1f1f1;
        }
        .output {
            background-color: #e9f7ef;
            border-left: 5px solid #28a745;
            padding: 10px;
            margin-top: 15px;
            border-radius: 4px;
        }
        .warning {
            background-color: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 10px;
            margin-top: 15px;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>RobustLinksV2 Class Showcase</h1>
        <p>This page demonstrates the various functionalities of the <code>RobustLinksV2</code> class.</p>

        ---

        <div class="section">
            <h2>1. Automatic Robust Link Creation (<code></code>)</h2>
            <p>
                The <code>RobustLinksV2</code> class can automatically convert plain links into robust links upon initialization.
                By default, it targets <code>a:not([data-originalurl])</code> elements.
                This section shows links that will be robustified using the default data producer logic.
            </p>
            <p>
                <a href="https://example.com/page1">Original Link 1 (Will be Robustified)</a> <br>
                <a href="https://www.google.com/">Google (Will be Robustified)</a> <br>
                <a href="https://en.wikipedia.org/">Wikipedia (Will be Robustified)</a>
            </p>
            <div class="output">
                <strong>Expected:</strong> The links above will gain <code>data-originalurl</code> and <code>data-versiondate</code> attributes, and potentially a dropdown arrow. Check developer tools to confirm.
            </div>
        </div>

        ---

        <div class="section">
            <h2>3. Creating Memento URIs (<code>createMementoUri</code>)</h2>
            <p>
                This demonstrates the creation of Memento URIs (URI-M or URI-G) using the <code>createMementoUri</code> method.
            </p>
            <ul>
                <li id="mementoUriTimeGate"><strong>TimeGate URI (latest):</strong> For <code>https://www.iana.org/</code></li>
                <li id="mementoUriSpecific"><strong>Memento URI (specific date):</strong> For <code>https://www.iana.org/domains/example</code> on <code>2020-05-15</code></li>
            </ul>
        </div>

        ---

        <div class="section">
            <h2>4. Dropdown Functionality & Customization</h2>
            <p>
                Robust Links can be configured to display a dropdown arrow, providing options like viewing
                the original (archived) page.
            </p>
            <p>
                The links in section 1 and 3 will have dropdowns because <code>enableDropdown</code> is set to <code>true</code>
                and a custom <code>dropdownArrowColor</code> and <code>dropdownArrowSize</code> are applied in the initialization.
            </p>
            <div class="output">
                <strong>Check:</strong> Hover over the robustified links in "Automatic Robust Link Creation" and "Manual Robust Link Update" sections. You should see a dropdown arrow, and clicking it should reveal options.
            </div>
        </div>

        ---

        <div class="section">
            <h2>5. Checking for Archive URLs (<code>isArchiveUrl</code>)</h2>
            <p>
                The <code>isArchiveUrl</code> method checks if a given URL matches known archive patterns.
            </p>
            <ul>
                <li><code>https://web.archive.org/web/20230101000000/http://example.com/</code>: <span id="isArchive1"></span></li>
                <li><code>https://example.com/regular-page</code>: <span id="isArchive2"></span></li>
            </ul>
        </div>

        ---

    </div>

    <script type="module">
        import { RobustLinksV2,  } from './robustlinks2.js';

        // --- 1. Automatic Robust Link Creation (autoInit: true) ---
        // Initialize RobustLinksV2 with default autoInit (true) and dropdowns enabled
        // This instance will robustify all 'a:not([data-originalurl])' links
        const rlDefaultAutoInit = new RobustLinksV2({
            
        });


        // --- 3. Manual Robust Link Update (updateAnchorToRobustLink) ---
        const robustifyButton = document.getElementById('robustifyButton');
        const manualLink = document.getElementById('manualLink');
        const manualLinkOutput = document.getElementById('manualLinkOutput');

        robustifyButton.addEventListener('click', () => {
            if (manualLink) {
                const originalUrl = "https://www.example.com/important-document";
                const versionDate = new Date('2024-03-20T12:00:00Z');
                const newHref = rlDefaultAutoInit.createMementoUri(originalUrl, versionDate);

                try {
                    rlDefaultAutoInit.updateAnchorToRobustLink(manualLink, {
                        originalUrl: originalUrl,
                        versionDate: versionDate,
                        versionSnapshots: [
                            { uri: "https://snapshot1.com/doc", datetime: "20240320120000" },
                            { uri: "https://snapshot2.org/doc" } // Snapshot without datetime
                        ],
                        newHref: newHref
                    });
                    manualLinkOutput.innerHTML = `Link robustified! Check its attributes. New href: <a href="${newHref}" target="_blank">${newHref}</a>`;
                } catch (error) {
                    manualLinkOutput.innerHTML = `<div class="warning">Error robustifying link: ${error.message}</div>`;
                    console.error("Error robustifying manual link:", error);
                }
            }
        });


        // --- 4. Parsing Existing Robust Links (findAndParseRobustLinks) ---
        const parseLinksButton = document.getElementById('parseLinksButton');
        const parsedLinksOutput = document.getElementById('parsedLinksOutput');

        parseLinksButton.addEventListener('click', () => {
            const parsedLinks = rlDefaultAutoInit.findAndParseRobustLinks(document.querySelector('.section:nth-of-type(4)')); // Limit search to this section
            parsedLinksOutput.textContent = JSON.stringify(parsedLinks, null, 2);
        });


        // --- 5. Creating Memento URIs (createMementoUri) ---
        const mementoUriTimeGate = document.getElementById('mementoUriTimeGate');
        const mementoUriSpecific = document.getElementById('mementoUriSpecific');

        // TimeGate URI (latest)
        const latestMemento = rlDefaultAutoInit.createMementoUri("https://www.iana.org/");
        mementoUriTimeGate.innerHTML += ` <a href="${latestMemento}" target="_blank">${latestMemento}</a>`;

        // Memento URI (specific date)
        const specificDate = new Date('2222-05-15T00:00:00Z'); // Using a future date for demonstration
        const specificMemento = rlDefaultAutoInit.createMementoUri("https://www.iana.org/domains/example", specificDate);
        mementoUriSpecific.innerHTML += ` <a href="${specificMemento}" target="_blank">${specificMemento}</a>`;


        // --- 7. Checking for Archive URLs (isArchiveUrl) ---
        const isArchive1 = document.getElementById('isArchive1');
        const isArchive2 = document.getElementById('isArchive2');

        isArchive1.textContent = rlDefaultAutoInit.isArchiveUrl('https://web.archive.org/web/20230101000000/http://example.com/');
        isArchive2.textContent = rlDefaultAutoInit.isArchiveUrl('https://example.com/regular-page');


        // --- 8. Static Utility Methods ---
        document.getElementById('parsedDate1').textContent = RobustLinksV2.parseDatetime('2023-04-20T10:00:00Z')?.toISOString() || 'Invalid';
        document.getElementById('parsedDate2').textContent = RobustLinksV2.parseDatetime('20230420100000')?.toISOString() || 'Invalid';
        document.getElementById('parsedDate3').textContent = RobustLinksV2.parseDatetime('2023-04-20')?.toISOString() || 'Invalid';
        document.getElementById('parsedDate4').textContent = RobustLinksV2.parseDatetime('20230420')?.toISOString() || 'Invalid';
        document.getElementById('parsedDate5').textContent = RobustLinksV2.parseDatetime('invalid-date')?.toISOString() || 'Invalid';

        document.getElementById('parsedVersionUrl1').textContent = JSON.stringify(RobustLinksV2.parseVersionUrl('https://snap.com/a 20230101 https://snap.com/b'), null, 2);
        document.getElementById('parsedVersionUrl2').textContent = JSON.stringify(RobustLinksV2.parseVersionUrl('https://snap.com/c'), null, 2);

    </script>
</body>
</html>